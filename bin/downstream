#!/usr/bin/env node

const config = require('config')
const readline = require('readline')
const io = require('socket.io-client')

const uri = process.argv[2] || `http://localhost:${config.get('port')}`
const socket = io(uri)
const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
})

function addTorrent (uri) {
  socket.emit('add', uri)
}

function getInput () {
  rl.question('>>> ', (answer) => {
    const args = answer.split(' ')
    if (args[0] === 'add') {
      addTorrent(args[1])
    }

    getInput()
  })
}

socket.on('connect', () => {
  console.log(`Connected established on ${uri}`)
  getInput()
})

socket.on('torrentMetadata', (torrent) => {
  console.log('Torrent added', torrent)
})

socket.on('torrentDownload', (torrent) => {
  console.log('Torrent progress', torrent)
})

socket.on('torrentDone', (uri) => {
  console.log('Torrent done', uri)
})
